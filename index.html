<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoverManga - Inicio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://images.emojiterra.com/microsoft/fluent-emoji/15.1/512px/1f3b4_color.png" type="image/png">
    <style>
        .hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            margin-bottom: 40px;
        }

        .hero h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.2em;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .slider-section {
            margin-bottom: 50px;
        }

        .slider-container {
            position: relative;
            margin: 20px 0;
        }

        .slider {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 10px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .slider::-webkit-scrollbar {
            display: none;
        }

        .slider-item {
            flex: 0 0 auto;
            width: 280px;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .slider-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .slider-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .slider-item .info {
            padding: 15px;
        }

        .slider-item h3 {
            margin: 0 0 8px 0;
            font-size: 1.1em;
            color: var(--text-color);
        }

        .slider-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        .slider-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .slider-nav button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            font-size: 0.9em;
        }

        .slider-nav button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .no-images-slider {
            text-align: center;
            padding: 40px;
            background: var(--card-bg);
            border-radius: 10px;
            color: #666;
        }

        .category-link {
            display: inline-block;
            margin-top: 15px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
        }

        .category-link:hover {
            color: var(--secondary-color);
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2em;
            }
            
            .hero p {
                font-size: 1em;
            }
            
            .slider-item {
                width: 250px;
            }
            
            .slider-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .slider-nav button {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <img src="https://images.emojiterra.com/microsoft/fluent-emoji/15.1/512px/1f3b4_color.png" alt="CoverManga" class="logo-img">
                <span>CoverManga</span>
            </div>
            
            <div class="menu-toggle" id="mobile-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
            
            <ul class="nav-menu">
                <li><a href="index.html" class="active">Inicio</a></li>
                <li><a href="portadas.html">Portadas</a></li>
                <li><a href="separadores.html">Separadores</a></li>
                <li><a href="cubrepolvos.html">Cubre Polvos</a></li>
                <li><button class="admin-btn" onclick="openAdminModal()">AD</button></li>
            </ul>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="hero">
                <h1>Bienvenido a CoverManga</h1>
                <p>Tu galer√≠a definitiva de portadas, separadores y cubre polvos de manga</p>
            </section>

            <!-- Carrusel Portadas -->
            <section class="slider-section">
                <h2 class="section-title">üé¥ Portadas Destacadas</h2>
                <div class="slider-container">
                    <div class="slider" id="portadas-slider">
                        <div class="loading">Cargando portadas...</div>
                    </div>
                    <div class="slider-nav">
                        <button onclick="scrollSlider('portadas-slider', -300)">‚ùÆ Anterior</button>
                        <a href="portadas.html" class="category-link">Ver todas las portadas</a>
                        <button onclick="scrollSlider('portadas-slider', 300)">Siguiente ‚ùØ</button>
                    </div>
                </div>
            </section>

            <!-- Carrusel Separadores -->
            <section class="slider-section">
                <h2 class="section-title">üìë Separadores Populares</h2>
                <div class="slider-container">
                    <div class="slider" id="separadores-slider">
                        <div class="loading">Cargando separadores...</div>
                    </div>
                    <div class="slider-nav">
                        <button onclick="scrollSlider('separadores-slider', -300)">‚ùÆ Anterior</button>
                        <a href="separadores.html" class="category-link">Ver todos los separadores</a>
                        <button onclick="scrollSlider('separadores-slider', 300)">Siguiente ‚ùØ</button>
                    </div>
                </div>
            </section>

            <!-- Carrusel Cubre Polvos -->
            <section class="slider-section">
                <h2 class="section-title">üõ°Ô∏è Cubre Polvos Destacados</h2>
                <div class="slider-container">
                    <div class="slider" id="cubrepolvos-slider">
                        <div class="loading">Cargando cubre polvos...</div>
                    </div>
                    <div class="slider-nav">
                        <button onclick="scrollSlider('cubrepolvos-slider', -300)">‚ùÆ Anterior</button>
                        <a href="cubrepolvos.html" class="category-link">Ver todos los cubre polvos</a>
                        <button onclick="scrollSlider('cubrepolvos-slider', 300)">Siguiente ‚ùØ</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 Derechos reservados a Jhorman Jes√∫s Castellanos Morales</p>
            <p class="acknowledgments">Agradecimientos especiales a nuestra comunidad de amantes del manga</p>
        </div>
    </footer>

    <!-- Modal Admin -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAdminModal()">&times;</span>
            <div id="loginForm" class="login-form">
                <h2>üîê Acceso Administraci√≥n</h2>
                <div class="form-group">
                    <input type="password" id="adminPassword" placeholder="Contrase√±a de administrador">
                </div>
                <button class="submit-btn" onclick="loginAdmin()">Ingresar</button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        // Navegaci√≥n m√≥vil
        document.getElementById('mobile-menu').addEventListener('click', function() {
            document.querySelector('.nav-menu').classList.toggle('active');
        });

        // Funciones del slider
        function scrollSlider(sliderId, amount) {
            const slider = document.getElementById(sliderId);
            slider.scrollBy({ left: amount, behavior: 'smooth' });
        }

        // Modal Admin
        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'flex';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                window.location.href = 'admin.html';
            } else {
                alert('‚ùå Contrase√±a incorrecta');
            }
        }

        // Cargar carruseles - VERSI√ìN CORREGIDA
        async function loadSliders() {
            try {
                console.log("üöÄ Cargando carruseles...");

                // Cargar cada categor√≠a por separado
                await loadCategorySlider('portadas', 'portadas-slider');
                await loadCategorySlider('separadores', 'separadores-slider');
                await loadCategorySlider('cubrepolvos', 'cubrepolvos-slider');

            } catch (error) {
                console.error('‚ùå Error cargando carruseles:', error);
            }
        }

        // Cargar carrusel por categor√≠a
        async function loadCategorySlider(category, sliderId) {
            try {
                console.log(`üìÇ Cargando ${category}...`);
                
                // Consulta optimizada con l√≠mite
                const snapshot = await db.collection('imagenes')
                    .where('category', '==', category)
                    .orderBy('timestamp', 'desc')
                    .limit(8) // M√°ximo 8 im√°genes por carrusel
                    .get();

                const slider = document.getElementById(sliderId);
                
                if (snapshot.empty) {
                    slider.innerHTML = `
                        <div class="no-images-slider">
                            <h3>No hay ${category} disponibles</h3>
                            <p>Ve al panel de administraci√≥n para subir el primer ${category.slice(0, -1)}</p>
                            <button class="admin-btn" onclick="openAdminModal()" style="margin-top: 10px;">
                                üì§ Subir ${category.slice(0, -1)}
                            </button>
                        </div>
                    `;
                    return;
                }

                slider.innerHTML = '';
                snapshot.forEach(doc => {
                    const image = doc.data();
                    const slide = document.createElement('div');
                    slide.className = 'slider-item';
                    slide.innerHTML = `
                        <img src="${image.url}" alt="${image.title}" 
                             loading="lazy"
                             onerror="this.src='https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=Imagen+No+Disponible'">
                        <div class="info">
                            <h3>${image.title}</h3>
                            ${image.series ? `<p>üìö ${image.series}</p>` : ''}
                            ${image.volume ? `<p>üìñ Vol. ${image.volume}</p>` : ''}
                        </div>
                    `;
                    
                    // Hacer la imagen clickeable para ver en grande
                    slide.addEventListener('click', () => {
                        window.open(image.url, '_blank', 'noopener,noreferrer');
                    });
                    
                    slider.appendChild(slide);
                });

                console.log(`‚úÖ ${category} cargados:`, snapshot.size);

            } catch (error) {
                console.error(`‚ùå Error cargando ${category}:`, error);
                const slider = document.getElementById(sliderId);
                slider.innerHTML = `
                    <div class="no-images-slider">
                        <h3>Error cargando ${category}</h3>
                        <p>${error.message}</p>
                        <button onclick="loadCategorySlider('${category}', '${sliderId}')" style="margin-top: 10px;">
                            üîÑ Reintentar
                        </button>
                    </div>
                `;
            }
        }

        // Mostrar notificaci√≥n
        function showNotification(message, type = 'info') {
            const tempMsg = document.createElement('div');
            const bgColor = type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db';
            
            tempMsg.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
            `;
            tempMsg.textContent = message;
            document.body.appendChild(tempMsg);
            
            setTimeout(() => {
                tempMsg.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(tempMsg)) {
                        document.body.removeChild(tempMsg);
                    }
                }, 300);
            }, 3000);
        }

        // Verificar conexi√≥n a Firebase
        function checkFirebaseConnection() {
            if (!db) {
                console.error('‚ùå Firebase no est√° inicializado');
                return false;
            }
            return true;
        }

        // Inicializar - C√ìDIGO OPTIMIZADO
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ Inicializando p√°gina de inicio...");
            
            if (!checkFirebaseConnection()) {
                // Mostrar error en todos los sliders
                ['portadas-slider', 'separadores-slider', 'cubrepolvos-slider'].forEach(sliderId => {
                    document.getElementById(sliderId).innerHTML = `
                        <div class="no-images-slider">
                            <h3>‚ùå Error de conexi√≥n</h3>
                            <p>No se pudo conectar a la base de datos</p>
                        </div>
                    `;
                });
                return;
            }
            
            // Cargar carruseles iniciales
            loadSliders();
            
            // Escuchar cambios en tiempo real (opcional)
            try {
                // Escuchar cambios en todas las categor√≠as
                ['portadas', 'separadores', 'cubrepolvos'].forEach(category => {
                    const unsubscribe = db.collection('imagenes')
                        .where('category', '==', category)
                        .orderBy('timestamp', 'desc')
                        .limit(8)
                        .onSnapshot(() => {
                            console.log(`üîÑ Actualizaci√≥n en ${category}`);
                            loadCategorySlider(category, `${category}-slider`);
                        }, error => {
                            console.warn(`‚ö†Ô∏è Error en listener de ${category}:`, error);
                        });
                    
                    // Limpiar listener cuando la p√°gina se cierre
                    window.addEventListener('beforeunload', () => {
                        unsubscribe();
                    });
                });
                
            } catch (error) {
                console.warn('‚ö†Ô∏è No se pudo establecer listeners tiempo real:', error);
            }
        });

        // Cerrar modal al hacer click fuera
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('adminModal');
            if (event.target === modal) {
                closeAdminModal();
            }
        });

        // Cerrar modal con Escape key
        document.addEventListener('keydown', function(event) {
            if (event.target !== document.getElementById('adminPassword') && event.key === 'Escape') {
                closeAdminModal();
            }
        });

        // Animaciones CSS para notificaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
