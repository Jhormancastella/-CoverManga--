<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoverManga - Inicio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://images.emojiterra.com/microsoft/fluent-emoji/15.1/512px/1f3b4_color.png" type="image/png">
    <style>
        .hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 15px;
            margin-bottom: 40px;
        }

        .hero h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.2em;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .slider-section {
            margin-bottom: 50px;
        }

        .slider-container {
            position: relative;
            margin: 20px 0;
        }

        .slider {
            display: flex;
            gap: 20px;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 10px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .slider::-webkit-scrollbar {
            display: none;
        }

        .slider-item {
            flex: 0 0 auto;
            width: 280px;
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .slider-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .slider-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .slider-item .info {
            padding: 15px;
        }

        .slider-item h3 {
            margin: 0 0 8px 0;
            font-size: 1.1em;
            color: var(--text-color);
        }

        .slider-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        /* Indicadores de puntos */
        .slider-indicators {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ddd;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider-dot.active {
            background: var(--primary-color);
            transform: scale(1.2);
        }

        .slider-dot:hover {
            background: var(--secondary-color);
        }

        /* Navegaci√≥n autom√°tica */
        .slider-nav-auto {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }

        .auto-nav-btn {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            margin: 0 5px;
        }

        .auto-nav-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .auto-nav-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .no-images-slider {
            text-align: center;
            padding: 40px;
            background: var(--card-bg);
            border-radius: 10px;
            color: #666;
        }

        .category-link {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
            font-size: 1.1em;
        }

        .category-link:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2em;
            }
            
            .hero p {
                font-size: 1em;
            }
            
            .slider-item {
                width: 250px;
            }
            
            .slider-indicators {
                flex-wrap: wrap;
            }
        }

        /* Animaciones para transiciones suaves */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slider-item {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <img src="https://images.emojiterra.com/microsoft/fluent-emoji/15.1/512px/1f3b4_color.png" alt="CoverManga" class="logo-img">
                <span>CoverManga</span>
            </div>
            
            <div class="menu-toggle" id="mobile-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
            
            <ul class="nav-menu">
                <li><a href="index.html" class="active">Inicio</a></li>
                <li><a href="portadas.html">Portadas</a></li>
                <li><a href="separadores.html">Separadores</a></li>
                <li><a href="cubrepolvos.html">Cubre Polvos</a></li>
                <li><button class="admin-btn" onclick="openAdminModal()">AD</button></li>
            </ul>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="hero">
                <h1>Bienvenido a CoverManga</h1>
                <p>Tu galer√≠a definitiva de portadas, separadores y cubre polvos de manga</p>
            </section>

            <!-- Carrusel Portadas -->
            <section class="slider-section">
                <h2 class="section-title">üé¥ Portadas Destacadas</h2>
                <div class="slider-container">
                    <div class="slider" id="portadas-slider">
                        <div class="loading">Cargando portadas...</div>
                    </div>
                    <div class="slider-indicators" id="portadas-indicators"></div>
                    <div class="slider-nav-auto">
                        <button class="auto-nav-btn" onclick="toggleAutoScroll('portadas')">‚è∏Ô∏è Pausar</button>
                    </div>
                </div>
                <a href="portadas.html" class="category-link">Ver todas las portadas ‚Üí</a>
            </section>

            <!-- Carrusel Separadores -->
            <section class="slider-section">
                <h2 class="section-title">üìë Separadores Populares</h2>
                <div class="slider-container">
                    <div class="slider" id="separadores-slider">
                        <div class="loading">Cargando separadores...</div>
                    </div>
                    <div class="slider-indicators" id="separadores-indicators"></div>
                    <div class="slider-nav-auto">
                        <button class="auto-nav-btn" onclick="toggleAutoScroll('separadores')">‚è∏Ô∏è Pausar</button>
                    </div>
                </div>
                <a href="separadores.html" class="category-link">Ver todos los separadores ‚Üí</a>
            </section>

            <!-- Carrusel Cubre Polvos -->
            <section class="slider-section">
                <h2 class="section-title">üõ°Ô∏è Cubre Polvos Destacados</h2>
                <div class="slider-container">
                    <div class="slider" id="cubrepolvos-slider">
                        <div class="loading">Cargando cubre polvos...</div>
                    </div>
                    <div class="slider-indicators" id="cubrepolvos-indicators"></div>
                    <div class="slider-nav-auto">
                        <button class="auto-nav-btn" onclick="toggleAutoScroll('cubrepolvos')">‚è∏Ô∏è Pausar</button>
                    </div>
                </div>
                <a href="cubrepolvos.html" class="category-link">Ver todos los cubre polvos ‚Üí</a>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>&copy; 2024 Derechos reservados a Jhorman Jes√∫s Castellanos Morales</p>
            <p class="acknowledgments">Agradecimientos especiales a nuestra comunidad de amantes del manga</p>
        </div>
    </footer>

    <!-- Modal Admin -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAdminModal()">&times;</span>
            <div id="loginForm" class="login-form">
                <h2>üîê Acceso Administraci√≥n</h2>
                <div class="form-group">
                    <input type="password" id="adminPassword" placeholder="Contrase√±a de administrador">
                </div>
                <button class="submit-btn" onclick="loginAdmin()">Ingresar</button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        // Estado de los carruseles
        const carouselState = {
            portadas: { currentIndex: 0, autoScroll: true, intervalId: null },
            separadores: { currentIndex: 0, autoScroll: true, intervalId: null },
            cubrepolvos: { currentIndex: 0, autoScroll: true, intervalId: null }
        };

        // Navegaci√≥n m√≥vil
        document.getElementById('mobile-menu').addEventListener('click', function() {
            document.querySelector('.nav-menu').classList.toggle('active');
        });

        // Modal Admin
        function openAdminModal() {
            document.getElementById('adminModal').style.display = 'flex';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                window.location.href = 'admin.html';
            } else {
                alert('‚ùå Contrase√±a incorrecta');
            }
        }

        // Funci√≥n para desplazamiento autom√°tico
        function startAutoScroll(category) {
            const state = carouselState[category];
            const slider = document.getElementById(`${category}-slider`);
            const indicators = document.getElementById(`${category}-indicators`);
            
            if (!slider || !indicators) return;

            state.intervalId = setInterval(() => {
                if (!state.autoScroll) return;
                
                const items = slider.querySelectorAll('.slider-item');
                if (items.length === 0) return;

                state.currentIndex = (state.currentIndex + 1) % items.length;
                scrollToItem(category, state.currentIndex);
            }, 4000); // Cambia cada 4 segundos
        }

        // Funci√≥n para desplazarse a un √≠tem espec√≠fico
        function scrollToItem(category, index) {
            const slider = document.getElementById(`${category}-slider`);
            const indicators = document.getElementById(`${category}-indicators`);
            const items = slider.querySelectorAll('.slider-item');
            
            if (items.length === 0) return;

            // Asegurar que el √≠ndice est√© en el rango
            index = (index + items.length) % items.length;
            carouselState[category].currentIndex = index;

            // Desplazar al √≠tem
            const item = items[index];
            const scrollPosition = item.offsetLeft - slider.offsetLeft;
            
            slider.scrollTo({
                left: scrollPosition,
                behavior: 'smooth'
            });

            // Actualizar indicadores
            updateIndicators(category, index);
        }

        // Funci√≥n para actualizar los puntos indicadores
        function updateIndicators(category, activeIndex) {
            const indicators = document.getElementById(`${category}-indicators`);
            const dots = indicators.querySelectorAll('.slider-dot');
            
            dots.forEach((dot, index) => {
                if (index === activeIndex) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // Funci√≥n para crear indicadores
        function createIndicators(category, count) {
            const indicators = document.getElementById(`${category}-indicators`);
            indicators.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const dot = document.createElement('button');
                dot.className = `slider-dot ${i === 0 ? 'active' : ''}`;
                dot.addEventListener('click', () => {
                    scrollToItem(category, i);
                    // Pausar auto-scroll temporalmente al hacer clic manual
                    pauseAutoScrollTemporarily(category);
                });
                indicators.appendChild(dot);
            }
        }

        // Pausar auto-scroll temporalmente
        function pauseAutoScrollTemporarily(category) {
            const state = carouselState[category];
            state.autoScroll = false;
            
            // Actualizar bot√≥n
            const button = document.querySelector(`[onclick="toggleAutoScroll('${category}')"]`);
            if (button) {
                button.textContent = '‚ñ∂Ô∏è Reanudar';
                button.classList.remove('active');
            }
            
            // Reanudar despu√©s de 10 segundos
            setTimeout(() => {
                if (!state.autoScroll) {
                    state.autoScroll = true;
                    if (button) {
                        button.textContent = '‚è∏Ô∏è Pausar';
                        button.classList.add('active');
                    }
                }
            }, 10000);
        }

        // Alternar auto-scroll
        function toggleAutoScroll(category) {
            const state = carouselState[category];
            const button = document.querySelector(`[onclick="toggleAutoScroll('${category}')"]`);
            
            state.autoScroll = !state.autoScroll;
            
            if (state.autoScroll) {
                button.textContent = '‚è∏Ô∏è Pausar';
                button.classList.add('active');
            } else {
                button.textContent = '‚ñ∂Ô∏è Reanudar';
                button.classList.remove('active');
            }
        }

        // Cargar carruseles - VERSI√ìN MEJORADA
        async function loadSliders() {
            try {
                console.log("üöÄ Cargando carruseles...");

                await loadCategoryCarousel('portadas');
                await loadCategoryCarousel('separadores');
                await loadCategoryCarousel('cubrepolvos');

            } catch (error) {
                console.error('‚ùå Error cargando carruseles:', error);
            }
        }

        // Cargar carrusel por categor√≠a
        async function loadCategoryCarousel(category) {
            try {
                console.log(`üìÇ Cargando ${category}...`);
                
                const snapshot = await db.collection('imagenes')
                    .where('category', '==', category)
                    .orderBy('timestamp', 'desc')
                    .limit(10) // M√°ximo 10 im√°genes por carrusel
                    .get();

                const slider = document.getElementById(`${category}-slider`);
                
                if (snapshot.empty) {
                    slider.innerHTML = `
                        <div class="no-images-slider">
                            <h3>No hay ${category} disponibles</h3>
                            <p>Ve al panel de administraci√≥n para subir el primer ${category.slice(0, -1)}</p>
                            <button class="admin-btn" onclick="openAdminModal()" style="margin-top: 10px;">
                                üì§ Subir ${category.slice(0, -1)}
                            </button>
                        </div>
                    `;
                    return;
                }

                slider.innerHTML = '';
                const images = [];
                
                snapshot.forEach(doc => {
                    images.push(doc.data());
                });

                images.forEach((image, index) => {
                    const slide = document.createElement('div');
                    slide.className = 'slider-item';
                    slide.innerHTML = `
                        <img src="${image.url}" alt="${image.title}" 
                             loading="lazy"
                             onerror="this.src='https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=Imagen+No+Disponible'">
                        <div class="info">
                            <h3>${image.title}</h3>
                            ${image.series ? `<p>üìö ${image.series}</p>` : ''}
                            ${image.volume ? `<p>üìñ Vol. ${image.volume}</p>` : ''}
                        </div>
                    `;
                    
                    // Hacer la imagen clickeable para ver en grande
                    slide.addEventListener('click', () => {
                        window.open(image.url, '_blank', 'noopener,noreferrer');
                    });
                    
                    slider.appendChild(slide);
                });

                // Crear indicadores
                createIndicators(category, images.length);
                
                // Iniciar auto-scroll
                startAutoScroll(category);

                console.log(`‚úÖ ${category} cargados:`, images.length);

            } catch (error) {
                console.error(`‚ùå Error cargando ${category}:`, error);
                const slider = document.getElementById(`${category}-slider`);
                slider.innerHTML = `
                    <div class="no-images-slider">
                        <h3>Error cargando ${category}</h3>
                        <p>${error.message}</p>
                        <button onclick="loadCategoryCarousel('${category}')" style="margin-top: 10px;">
                            üîÑ Reintentar
                        </button>
                    </div>
                `;
            }
        }

        // Mostrar notificaci√≥n
        function showNotification(message, type = 'info') {
            const tempMsg = document.createElement('div');
            const bgColor = type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db';
            
            tempMsg.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: slideIn 0.3s ease;
            `;
            tempMsg.textContent = message;
            document.body.appendChild(tempMsg);
            
            setTimeout(() => {
                tempMsg.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(tempMsg)) {
                        document.body.removeChild(tempMsg);
                    }
                }, 300);
            }, 3000);
        }

        // Verificar conexi√≥n a Firebase
        function checkFirebaseConnection() {
            if (!db) {
                console.error('‚ùå Firebase no est√° inicializado');
                return false;
            }
            return true;
        }

        // Inicializar - C√ìDIGO OPTIMIZADO
        document.addEventListener('DOMContentLoaded', function() {
            console.log("üöÄ Inicializando p√°gina de inicio...");
            
            if (!checkFirebaseConnection()) {
                ['portadas', 'separadores', 'cubrepolvos'].forEach(category => {
                    document.getElementById(`${category}-slider`).innerHTML = `
                        <div class="no-images-slider">
                            <h3>‚ùå Error de conexi√≥n</h3>
                            <p>No se pudo conectar a la base de datos</p>
                        </div>
                    `;
                });
                return;
            }
            
            // Cargar carruseles iniciales
            loadSliders();
            
            // Pausar auto-scroll cuando el usuario interact√∫e
            ['portadas', 'separadores', 'cubrepolvos'].forEach(category => {
                const slider = document.getElementById(`${category}-slider`);
                if (slider) {
                    slider.addEventListener('mouseenter', () => {
                        carouselState[category].autoScroll = false;
                    });
                    
                    slider.addEventListener('mouseleave', () => {
                        if (document.querySelector(`[onclick="toggleAutoScroll('${category}')"]`).textContent === '‚è∏Ô∏è Pausar') {
                            carouselState[category].autoScroll = true;
                        }
                    });
                }
            });
        });

        // Cerrar modal al hacer click fuera
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('adminModal');
            if (event.target === modal) {
                closeAdminModal();
            }
        });

        // Cerrar modal con Escape key
        document.addEventListener('keydown', function(event) {
            if (event.target !== document.getElementById('adminPassword') && event.key === 'Escape') {
                closeAdminModal();
            }
        });

        // Limpiar intervals cuando la p√°gina se cierre
        window.addEventListener('beforeunload', () => {
            Object.values(carouselState).forEach(state => {
                if (state.intervalId) {
                    clearInterval(state.intervalId);
                }
            });
        });

        // Animaciones CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
